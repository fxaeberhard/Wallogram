<!doctype html>
<html>
<head>
  <title>Wallogram</title>
  
  
 	 <!--	Online version -->
	<!--<link rel="stylesheet" type="text/css" 
		href="http://yui.yahooapis.com/combo?3.3.0/build/cssfonts/fonts-min.css&3.3.0/build/cssreset/reset-min.css&3.3.0/build/cssgrids/grids-min.css&3.3.0/build/cssbase/base-min.css" charset="utf-8" /> 
	 -->
	    
	<link rel="stylesheet" type="text/css" href="lib/yui3/build/cssfonts/fonts-min.css" />
	<link rel="stylesheet" type="text/css" href="lib/yui3/build/cssreset/reset-min.css" />
	
	<meta id="customstyles" /> 
</head>
<body>

<div class="container">

  <div class="span-20" id="content">        
    <p id="instructions" class="notice">
      HTML5 logo below will track the orientation of your iPhone or iPod. You must have IOS 4.2 installed.
      To start you must pair your IOS device and desktop browser. You can do this by visiting address 
      <b><a href="http://appelsiini.net/demo/websocket/iphone.html">appelsiini.net/ws</a></b> with your iPhone or iPad
      and enter PIN code <b id="pin">xxxx</b>. 
    </p>

    <p id="connected" class="success" style="display:none;">
      Now try tilting and turning your iPhone or iPod. HTML5 logo below will track the orientation of your IOS device.
      Since iPhone 4 or iPod Touch 4G have gyroscopes tracking will be more accurate. Response rate in this demo has 
      been degraded on purpose to prevent mobile browser sending data  50 times per second.
    </p>
    
  </div>
</div>
<!-- YUI Base Classes -->
<!--<script type="text/javascript" src="http://yui.yahooapis.com/combo?3.3.0pr3/build/yui/yui-min.js&3.3.0pr3/build/loader/loader-min.js"></script> 
-->
<script type="text/javascript" src="lib/yui3/build/yui/yui.js"></script> 
<script type="text/javascript" src="lib/yui3/build/loader/loader.js"></script> 
	
<script type="text/javascript" charset="utf-8">

var Y = YUI({
    debug: true,
    insertBefore: 'customstyles'
    filter: 'raw'
}).use('node', 'event', function (Y) {
	if (!WebSocket) {
		alert("Your browser does not support WebSockets. Too bad. You can only control one avatar using arrow keys.");
		return;
	}
	
    function pad(number, length) {
        var str = '' + number;
        while (str.length < length) {
            str = '0' + str;
        }

        return str;
    }

    var pin = pad(Math.floor(Math.random() * 9999), 4);
    $("#pin").text(pin);

    var socket = new WebSocket("ws://ws.appelsiini.net:8080/iphone/" + pin);

    socket.onopen = function(event) {
    };

    socket.onmessage = function(event) {
        var payload = JSON.parse(event.data);
        if (payload.data) {
            if ("orientation" == payload.type) {
                $("#elevator").css("-webkit-transform", "rotateX(" + payload.data.x * -1 + "deg)");
                $("#aileron").css("-webkit-transform", "rotateZ(" + payload.data.y * 1 + "deg)");
                $("#pitch").css("-webkit-transform", "rotateY(" + payload.data.z * 1 + "deg)");              
            } else {
                $("#elevator").css("-webkit-transform", "rotateX(" + payload.data.y * 1 + "deg)");
                $("#aileron").css("-webkit-transform", "rotateZ(" + payload.data.x * 1 + "deg)");
            }
        }
        if (payload.server) {
            if (payload.server.match(/disconnected/)) {
                $("#instructions").show();
                $("#connected").hide();  
                $("#elevator").css("-webkit-transform", "rotateX(0deg)");
                $("#aileron").css("-webkit-transform", "rotateZ(0deg)");
                $("#pitch").css("-webkit-transform", "rotateY(0deg)");  
            }
        }
        if (payload.mobile) {
            if ("Mobile connected" == payload.mobile) {
                Y.one("#instructions").hide();
                Y.one("#connected").show();                    
            }
        }
    };

    socket.onclose = function(event) {
    };

});
</script>
</body>
</html>