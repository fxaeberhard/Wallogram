YUI.add("inputex-list",function(c){var b=c.Lang,a=c.inputEx;a.ListField=function(d){this.subFields=[];a.ListField.superclass.constructor.call(this,d)};c.extend(a.ListField,a.Field,{arrowAnimColors:{from:"#eeee33",to:"#eeeeee"},setOptions:function(d){a.ListField.superclass.setOptions.call(this,d);this.options.className=d.className?d.className:"inputEx-Field inputEx-ListField";this.options.sortable=b.isUndefined(d.sortable)?false:d.sortable;this.options.elementType=d.elementType||{type:"string"};this.options.useButtons=b.isUndefined(d.useButtons)?true:d.useButtons;this.options.unique=b.isUndefined(d.unique)?false:d.unique;this.options.listAddLabel=d.listAddLabel||a.messages.listAddLink;this.options.listRemoveLabel=d.listRemoveLabel||a.messages.listRemoveLink;this.options.maxItems=d.maxItems;this.options.minItems=d.minItems},renderComponent:function(){if(this.options.useButtons){this.addButton=a.cn("img",{src:a.spacerUrl,className:"inputEx-ListField-addButton"});this.fieldContainer.appendChild(this.addButton)}this.fieldContainer.appendChild(a.cn("span",null,{marginLeft:"4px"},this.options.listLabel));this.childContainer=a.cn("div",{className:"inputEx-ListField-childContainer"});this.fieldContainer.appendChild(this.childContainer);if(!this.options.useButtons){this.addButton=a.cn("a",{className:"inputEx-List-link"},null,this.options.listAddLabel);this.fieldContainer.appendChild(this.addButton)}},initEvents:function(){c.one(this.addButton).on("click",this.onAddButton,this,true)},validate:function(){var f=true;var k={};var d=this.subFields.length;if(b.isNumber(this.options.minItems)&&d<this.options.minItems){f=false}if(b.isNumber(this.options.maxItems)&&d>this.options.maxItems){f=false}for(var g=0;g<d&&f;g++){var e=this.subFields[g];var h=e.getState();e.setClassFromState(h);if(h==a.stateRequired||h==a.stateInvalid){f=false}if(this.options.unique){var j=b.dump(e.getValue());if(k[j]){f=false}else{k[j]=true}}}return f},setValue:function(g,d){if(!b.isArray(g)){throw new Error("inputEx.ListField.setValue expected an array, got "+(typeof g))}for(var f=0;f<g.length;f++){if(f==this.subFields.length){this.addElement(g[f])}else{this.subFields[f].setValue(g[f],false)}}var e=this.subFields.length-g.length;if(e>0){for(f=0;f<e;f++){this.removeElement(g.length)}}a.ListField.superclass.setValue.call(this,g,d)},getValue:function(){var d=[];for(var e=0;e<this.subFields.length;e++){d[e]=this.subFields[e].getValue()}return d},destroy:function(){for(var d=0;d<this.subFields.length;d++){this.subFields[d].destroy()}a.ListField.superclass.destroy.call(this)},addElement:function(e){var d=this.renderSubField(e);if(this.options.name){d.setFieldName(this.options.name+"["+this.subFields.length+"]")}this.subFields.push(d);return d},resetAllNames:function(){if(this.options.name){for(var e=0;e<this.subFields.length;e++){var d=this.subFields[e];d.setFieldName(this.options.name+"["+e+"]")}}},onAddButton:function(f){f.halt();if(b.isNumber(this.options.maxItems)&&this.subFields.length>=this.options.maxItems){return}var d=this.addElement();d.focus();this.fireUpdatedEvt()},renderSubField:function(k){var g=a.cn("div"),e;if(this.options.useButtons){e=a.cn("img",{src:a.spacerUrl,className:"inputEx-ListField-delButton"});c.one(e).on("click",this.onDelete,this);g.appendChild(e)}var j=c.merge({},this.options.elementType);if(!b.isUndefined(k)){j.value=k}var h=a(j,this);var f=h.getEl();c.one(f).addClass("inputEx-ListField-subFieldEl");g.appendChild(f);h.on("updated",this.onChange,this,true);if(this.options.sortable){var i=a.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowUp"});c.one(i).on("click",this.onArrowUp,this);var d=a.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowDown"});c.one(d).on("click",this.onArrowDown,this,true);g.appendChild(i);g.appendChild(d)}if(!this.options.useButtons){e=a.cn("a",{className:"inputEx-List-link"},null,this.options.listRemoveLabel);c.one(e).on("click",this.onDelete,this);g.appendChild(e)}g.appendChild(a.cn("div",null,{clear:"both"}));this.childContainer.appendChild(g);return h},onArrowUp:function(l){var h=l.target._node.parentNode;var f=null;var g=-1;for(var j=1;j<h.parentNode.childNodes.length;j++){var d=h.parentNode.childNodes[j];if(d==h){f=h.parentNode.childNodes[j-1];g=j;break}}if(f){var m=this.childContainer.removeChild(h);var k=this.childContainer.insertBefore(m,f);var n=this.subFields[g];this.subFields[g]=this.subFields[g-1];this.subFields[g-1]=n;this.resetAllNames();if(this.arrowAnim){this.arrowAnim.stop(true)}this.arrowAnim=new c.Anim({node:k,from:{backgroundColor:this.arrowAnimColors.from},to:{backgroundColor:this.arrowAnimColors.to},duration:0.4});this.arrowAnim.on("end",function(){c.one(k).setStyle("backgroundColor","")});this.arrowAnim.run();this.fireUpdatedEvt()}},onArrowDown:function(l){var g=l.target._node.parentNode;var f=-1;var k=null;for(var h=0;h<g.parentNode.childNodes.length;h++){var d=g.parentNode.childNodes[h];if(d==g){k=g.parentNode.childNodes[h+1];f=h;break}}if(k){var m=this.childContainer.removeChild(g);var j=c.one(k).insert(m,"after");var n=this.subFields[f];this.subFields[f]=this.subFields[f+1];this.subFields[f+1]=n;this.resetAllNames();if(this.arrowAnim){this.arrowAnim.stop(true)}this.arrowAnim=new c.Anim({node:j,from:{backgroundColor:this.arrowAnimColors.from},to:{backgroundColor:this.arrowAnimColors.to},duration:1});this.arrowAnim.on("end",function(){c.one(j).setStyle("backgroundColor","")});this.arrowAnim.run();this.fireUpdatedEvt()}},onDelete:function(j){j.halt();if(b.isNumber(this.options.minItems)&&this.subFields.length<=this.options.minItems){return}var f=j.target._node.parentNode;var d=-1;var h=f.childNodes[this.options.useButtons?1:0];for(var g=0;g<this.subFields.length;g++){if(this.subFields[g].getEl()==h){d=g;break}}if(d!=-1){this.removeElement(d)}this.resetAllNames();this.fireUpdatedEvt()},removeElement:function(e){var d=this.subFields[e].getEl().parentNode;this.subFields[e]=undefined;this.subFields=a.compactArray(this.subFields);d.parentNode.removeChild(d)},clear:function(d){this.setValue(b.isUndefined(this.options.value)?[]:this.options.value,d)}});a.registerType("list",a.ListField,[{type:"string",label:"List label",name:"listLabel",value:""},{type:"type",label:"List element type",required:true,name:"elementType"}])},"3.1.0",{requires:["inputex-field","anim"]});