YUI.add("inputex-stringavailability",function(c){var b=c.Lang,a=c.inputEx;a.StringAvailability=function(d){a.StringAvailability.superclass.constructor.call(this,d)};c.extend(a.StringAvailability,a.StringField,{setOptions:function(d){a.StringAvailability.superclass.setOptions.call(this,d);this.options.uri=d.uri;this.options.messages.stringLoading=(d.messages&&d.messages.stringLoading)?d.messages.stringLoading:a.messages.stringLoading;this.options.messages.stringAvailable=(d.messages&&d.messages.stringAvailable)?d.messages.stringAvailable:a.messages.stringAvailable;this.options.messages.stringUnAvailable=(d.messages&&d.messages.stringUnAvailable)?d.messages.stringUnAvailable:a.messages.stringUnAvailable;this.options.messages.errorDataText=(d.messages&&d.messages.errorDataText)?d.messages.errorDataText:a.messages.errorDataText;this.options.showMsg=false;this.isRequesting=false},render:function(){a.StringAvailability.superclass.render.call(this);c.one(this.fieldContainer).insert(this.availabilityDiv,"after")},renderComponent:function(){a.StringAvailability.superclass.renderComponent.call(this);this.availabilityDiv=a.cn("div",{className:"availabilityDiv"});this.availabilityDivIcon=a.cn("div",{className:"icon"});this.availabilityDivText=a.cn("div",{className:"text"});this.availabilityDiv.appendChild(this.availabilityDivIcon);this.availabilityDiv.appendChild(this.availabilityDivText);this.availabilityDiv.appendChild(a.cn("div",{className:"clear"}))},initEvents:function(){a.StringAvailability.superclass.initEvents.call(this)},onKeyPress:function(d){if(d.keyCode===9){return}this.isRequesting=true;b.later(0,this,function(){if(this.getValue()===""){this.stopTimer();this.setAvailabilityState(this.options.required?"required":"none");return}this.resetTimer();this.setAvailabilityState("loading")})},resetTimer:function(){this.stopTimer();this.startTimer()},startTimer:function(){var d=this;this.timerId=setTimeout(function(){d.getAvailability(d.getValue())},500)},stopTimer:function(){if(this.timerId){clearTimeout(this.timerId);delete this.timerId}},onAvailable:function(){this.setAvailabilityState("available");this.isAvailable=true;this.isRequesting=false},onUnavailable:function(){this.setAvailabilityState("unavailable");this.isAvailable=false;this.isRequesting=false},onFailure:function(){this.setAvailabilityState("fail");this.isAvailable=false;this.isRequesting=false},setAvailabilityState:function(d){if(d==="none"){this.availabilityDivText.innerHTML="";c.one(this.availabilityDiv).set("className","availabilityDiv");this.availabilityDiv.style.display="none";return}else{if(d==="loading"){this.availabilityDivText.innerHTML=this.options.messages.stringLoading}else{if(d==="available"){this.availabilityDivText.innerHTML=this.options.messages.stringAvailable}else{if(d==="unavailable"){this.availabilityDivText.innerHTML=this.options.messages.stringUnAvailable}else{if(d==="required"){this.availabilityDivText.innerHTML=this.options.messages.required}else{if(d==="fail"){this.availabilityDivText.innerHTML=this.options.messages.errorDataText}}}}}}c.one(this.availabilityDiv).set("className","availabilityDiv "+d);this.availabilityDiv.style.display="block"},setClassFromState:function(){a.StringAvailability.superclass.setClassFromState.call(this);var d=this.getState();if(d==="required"){this.setAvailabilityState(d)}},validate:function(){if(!!this.isRequesting){return false}var d=a.StringAvailability.superclass.validate.call(this);if(!b.isUndefined(this.isAvailable)){d=this.isAvailable&&d}return d},getAvailability:function(d){var f=this,e={data:{availabilityRequest:d},on:{success:function(i,h){var g=c.JSON.parse(h.responseText);if(g==="true"||!!g){f.onAvailable()}else{if(g==="false"||!g){f.onUnavailable()}}},failure:function(h,g){f.onFailure(g)}}};c.io(this.options.uri,e)}});a.registerType("string-availability",a.StringAvailability)},"3.1.0",{requires:["inputex-string","event-key","io","json-parse"]});