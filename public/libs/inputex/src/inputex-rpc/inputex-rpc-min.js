YUI.add("inputex-rpc",function(d){var c=d.Lang,a=d.inputEx;a.RPC={generateServiceForm:function(j,h,i){var f=null;if(c.isObject(h)&&c.isArray(h.fields)){f=h}else{f=a.RPC.formForMethod(j);d.mix(f,h,true)}var e=j._methodName||j.name;f.type="form";if(!f.buttons){f.buttons=[{type:"submit",value:e,onClick:function(){g.showMask();j(g.getValue(),{success:function(k){g.hideMask();if(c.isObject(i)&&c.isFunction(i.success)){i.success.call(i.scope||this,k)}},failure:function(){g.hideMask()}});return false}}]}var g=a(f);return g},formForMethod:function(l){var h={};var f=l._methodName||l.name;h[f]={id:f,type:"object",properties:{}};for(var j=0;j<l._parameters.length;j++){var k=l._parameters[j];h[f].properties[k.name]=k}var e=new a.JsonSchema.Builder({schemaIdentifierMap:h,defaultOptions:{showMsg:true}});var g=e.schemaToInputEx(h[f]);return g}};var b=a.RPC;a.RPC.Service=function(e,f){if(c.isString(e)){this.smdUrl=e;this.fetch(e,f)}else{if(c.isObject(e)){this._smd=e;this.process(f)}else{throw new Error("smd should be an object or an url")}}};a.RPC.Service.prototype={_generateService:function(f,h){if(this[h]){throw new Error("WARNING: "+f+" already exists for service. Unable to generate function")}h.name=f;h._methodName=f;var e=this;var g=function(q,k){var u=b.Envelope[h.envelope||e._smd.envelope];var w={success:function(p){var i=u.deserialize(p);k.success.call(k.scope||e,i)},failure:function(p){if(c.isFunction(k.failure)){var i=u.deserialize(p);k.failure.call(k.scope||e,i)}},scope:e};var n={};if(e._smd.additionalParameters&&c.isArray(e._smd.parameters)){for(var s=0;s<e._smd.parameters.length;s++){var m=e._smd.parameters[s];n[m.name]=m["default"]}}d.mix(n,q,true);var l=h.target||e._smd.target;var t=/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(([0-9]{1,5})?\/.*)?$/i;if(!l.match(t)&&l!=e._smd.target){l=e._smd.target+l}if(!!this.smdUrl&&!l.match(t)){var v=this.smdUrl.split("/");v[v.length-1]="";l=v.join("/")+l}var j={target:l,callback:w,data:n,origData:q,opts:k,callbackParamName:h.callbackParamName||e._smd.callbackParamName,transport:h.transport||e._smd.transport};var o=u.serialize(e._smd,h,n);d.mix(j,o,true);b.Transport[j.transport].call(e,j)};g.name=f;g._methodName=f;g.description=h.description;g._parameters=h.parameters;return g},process:function(k){var e=this._smd.services;for(var g in e){if(e.hasOwnProperty(g)){var j=this;var h=g.split(".");for(var f=0;f<h.length-1;f++){j=j[h[f]]||(j[h[f]]={})}j[h[h.length-1]]=this._generateService(g,e[g])}}if(c.isObject(k)&&c.isFunction(k.success)){k.success.call(k.scope||this)}},fetch:function(f,g){var e={method:"GET",on:{success:function(i,j){try{this._smd=d.JSON.parse(j.responseText);this.process(g)}catch(h){if(c.isObject(console)&&c.isFunction(console.log)){console.log(h)}if(c.isFunction(g.failure)){g.failure.call(g.scope||this,{error:h})}}},failure:function(h,i){if(c.isFunction(g.failure)){g.failure.call(g.scope||this,{error:"unable to fetch url "+f})}}},context:this};d.io(f,e)}};a.RPC.Service._requestId=1;a.RPC.Transport={POST:function(e){return d.io(e.target,{method:"POST",on:{succes:e.callback},data:e.data})},GET:function(e){return d.io(e.target+(e.data?"?"+e.data:""),{method:"GET",on:{success:e.callback}})},REST:function(e){},JSONP:function(f){var e=f.target+((f.target.indexOf("?")==-1)?"?":"&")+f.data+"&"+f.callbackParamName+"={callback}";d.jsonp(e,function(g){if(c.isObject(f.callback)&&c.isFunction(f.callback.success)){f.callback.success.call(f.callback.scope||this,g)}})},"TCP/IP":function(e){throw new Error("TCP/IP transport not implemented !")}};a.RPC.Envelope={URL:{serialize:function(l,m,h){var j=encodeURIComponent;var k=[];for(var e in h){if(h.hasOwnProperty(e)){var g=h[e];if(c.isArray(g)){for(var f=0;f<g.length;f++){k.push(j(e)+"="+j(g[f]))}}else{k.push(j(e)+"="+j(g))}}}return{data:k.join("&")}},deserialize:function(e){return e}},PATH:{serialize:function(h,j,f){var g=j.target||h.target,e;if(c.isArray(f)){for(e=0;e<f.length;e++){g+="/"+f[e]}}else{for(e in f){if(f.hasOwnProperty(e)){g+="/"+e+"/"+f[e]}}}return{data:"",target:g}},deserialize:function(e){return e}},JSON:{serialize:function(f,g,e){return{data:d.JSON.stringify(e)}},deserialize:function(e){return e}},"JSON-RPC-1.0":{serialize:function(g,h,f){var e=h.name||h._methodName;return{data:d.JSON.stringify({id:b.Service._requestId++,method:e,params:f})}},deserialize:function(e){return d.JSON.parse(e.responseText)}},"JSON-RPC-2.0":{serialize:function(g,h,f){var e=h.name||h._methodName;return{data:d.JSON.stringify({id:b.Service._requestId++,method:e,version:"json-rpc-2.0",params:f})}},deserialize:function(e){return d.JSON.parse(e.responseText)}}}},"3.1.0",{requires:["json","inputex","io","inputex-jsonschema","jsonp"]});